#!/bin/bash -eux

export CI=1
export RAILS_ENV=test
export COVERAGE=1
export SPEC_OPTS="--format p"

output="$(git submodule update --remote)"
echo -n "$output"
test -z "$output"

bundle install

bundle exec rubocop -DES
bundle exec brakeman -qz --no-progress -w3
bundle exec cane --no-doc --style-measure 160 --abc-max 30

$(dirname $0)/check_i18n

bundle exec bundle-audit update
bundle exec bundle-audit check

bundle exec rake

