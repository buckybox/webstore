= render partial: 'order', object: order

= simple_form_for(payment_options, url: payment_options_path, html: { novalidate: false }) do |f|
  = f.input :cart_id, as: :hidden

  #webstore-address.row-fluid.webstore-section
    .span12
      - show_address_form = !payment_options.address_complete? || payment_options.pickup_point?

      #existing-address.row-fluid{ :class => ("hide" if show_address_form) }
        .span12
          .row-fluid
            .span12
              %h4= t 'payment_options.deliver_to'
          .row-fluid
            .span12
              -# = payment_options.address.to_s('<br>')
              ADDRESS
              %br
            = link_to t('payment_options.change_delivery_address'), 'javascript:void(0)', id: 'edit-address'
      #update-address.row-fluid{ :class => ("hide" unless show_address_form) }
        .span12
          .row-fluid
            .span12
              %h4= t 'payment_options.name'
          .row-fluid
            .span12= f.input :name, label: false, placeholder: t('payment_options.enter_name'), input_html: { class: 'span12', required: true }

          - if payment_options.collect_phone
            .row-fluid
              .span12
                %h4= t 'payment_options.phone'
            .row-fluid
              .span9= f.input :phone_number, label: false, placeholder: t('payment_options.enter_phone'), input_html: { class: 'span12', value: payment_options.default_phone_number, required: payment_options.require_phone }
              .span3= f.input :phone_type, collection: payment_options.phone_types, label: false, input_html: { class: 'span12', required: payment_options.require_phone }, include_blank: false, selected: payment_options.default_phone_type

          - unless payment_options.pickup_point?
            .row-fluid
              .span12
                %h4= t 'payment_options.deliver_to'
            .row-fluid
              .span12
                = f.input :address_1, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.address_1'), input_html: { class: 'span12', required: payment_options.require_address_1 }
                = f.input :address_2, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.address_2'), label: false, input_html: { class: 'span12', required: payment_options.require_address_2 }
                = f.input :suburb, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.suburb'), input_html: { class: 'span12', required: payment_options.require_suburb }
            .row-fluid
              .span9= f.input :city, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.city'), input_html: { class: 'span12' }, wrapper_html: { id: 'city', required: payment_options.require_city }
              .span3= f.input :postcode, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.postcode'), input_html: { class: 'span12', required: payment_options.require_postcode }, wrapper_html: { id: 'postal_code' }

            - if payment_options.collect_delivery_note
              .row-fluid
                .span12
                  %h4= t('virtus.attributes.customer/form/update_delivery_address.delivery_note')
              .row-fluid
                .span12
                  = f.input :delivery_note, as: :text, label: false, placeholder: t('virtus.attributes.customer/form/update_delivery_address.placeholders.delivery_note'), input_html: { class: 'span12', rows: 3, required: payment_options.require_delivery_note }

  - if cart.has_payment_options?
    - if payment_options.existing_customer?
      .row-fluid.webstore-section
        = render partial: 'payment_instructions', locals: { form_object: cart }

    .row-fluid.webstore-section
      #webstore-payment.span12
        .row-fluid
          #amount-due.span12
            .row-fluid.important
              - if cart.negative_closing_balance?
                .span10= t 'payment_options.amount_due'
                .span2.text-right.total_price
                  = cart.amount_due
              - else
                .span10= t 'payment_options.in_credit'

        .row-fluid
          #payment-options.span12
            - if cart.negative_closing_balance?
              .row-fluid
                .form-horizontal.span6.center-row
                  = f.input :payment_method, as: :radio_buttons, collection: cart.payment_list, checked: payment_options.payment_method, label: t('payment_options.pay_by') << t('colon'), label_html: { class: 'emphasised-label' }
            - else
              .span12.text-center= t 'payment_options.no_payment'
              = f.input :payment_method, as: :hidden, input_html: { value: PaymentOption::PAID }

  .row-fluid
    .span12.text-center
      = f.input :complete, as: :hidden, input_html: { value: true }
      = f.button :submit, t('payment_options.complete_order'), class: 'btn btn-process'

